import{u as V,a as Y,r as m,f as y,j as e,L as p,H as J,C as L}from"./index-BPsclh6Z.js";import{g as N,L as k,D as Z}from"./config-BrudmqDi.js";import{Z as Q}from"./zap-DYDZDxsz.js";import{L as ee,a as se}from"./log-out-D0OnYY7e.js";import{C as T}from"./credit-card-CBTBdjNB.js";import{U as te}from"./user-ORimhEMD.js";import{C as $}from"./check-_7kSY-4X.js";var M="https://js.stripe.com/v3",re=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var ae=function(){for(var r=document.querySelectorAll('script[src^="'.concat(M,'"]')),a=0;a<r.length;a++){var n=r[a];if(re.test(n.src))return n}return null},D=function(r){var a="",n=document.createElement("script");n.src="".concat(M).concat(a);var l=document.head||document.body;if(!l)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return l.appendChild(n),n},le=function(r,a){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:a})},u=null,v=null,w=null,ne=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},ie=function(r,a){return function(){window.Stripe?r(window.Stripe):a(new Error("Stripe.js not available"))}},oe=function(r){return u!==null?u:(u=new Promise(function(a,n){if(typeof window>"u"||typeof document>"u"){a(null);return}if(window.Stripe){a(window.Stripe);return}try{var l=ae();if(!(l&&r)){if(!l)l=D(r);else if(l&&w!==null&&v!==null){var t;l.removeEventListener("load",w),l.removeEventListener("error",v),(t=l.parentNode)===null||t===void 0||t.removeChild(l),l=D(r)}}w=ie(a,n),v=ne(n),l.addEventListener("load",w),l.addEventListener("error",v)}catch(S){n(S);return}}),u.catch(function(a){return u=null,Promise.reject(a)}))},ce=function(r,a,n){if(r===null)return null;var l=r.apply(void 0,a);return le(l,n),l},h,U=!1,B=function(){return h||(h=oe(null).catch(function(r){return h=null,Promise.reject(r)}),h)};Promise.resolve().then(function(){return B()}).catch(function(i){U||console.warn(i)});var de=function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];U=!0;var l=Date.now();return B().then(function(t){return ce(t,a,l)})};const R="pk_test_51S48yyPWjc2GvwDdJ6GJHdKYj1SKGCxVXhzzEYqvgq0BuECVzuq2OfrdlMOwRoqzhJmN0y1KXaM2XHO3COs2FNou00wBQ2bmOd",O=de(R),ye=()=>{const i=V(),{user:r,logout:a}=Y(),[n,l]=m.useState(!0),[t,S]=m.useState(null),[P,z]=m.useState(null),[xe,me]=m.useState(null),[A,g]=m.useState(!1),[I,d]=m.useState(""),[E,C]=m.useState("");m.useEffect(()=>{f(),_()},[]);const f=async()=>{try{const s=localStorage.getItem("access_token"),x=await y.get(N("/api/billing/info"),{headers:{Authorization:`Bearer ${s}`}});S(x.data)}catch(s){console.error("Error fetching billing info:",s),d("Failed to load billing information")}},_=async()=>{try{const s=await y.get(N("/api/billing/pricing"));z(s.data.tiers),l(!1)}catch(s){console.error("Error fetching pricing:",s),l(!1)}},F=async s=>{console.log("Subscribing to tier:",s);const x=P?.[s];if(!x){d("Invalid subscription tier");return}g(!0),d("");try{const o=localStorage.getItem("access_token");if(!o){d("Please login to subscribe"),i("/login");return}console.log("Calling subscription API...");const c=await y.post(N("/api/billing/subscription"),{tier:s},{headers:{Authorization:`Bearer ${o}`}});if(console.log("Subscription response:",c.data),c.data.checkout_url)console.log("Redirecting to Stripe Checkout..."),window.location.href=c.data.checkout_url;else if(c.data.client_secret){if(!O){d("Payment system is not configured.");return}const b=await(await O).confirmCardPayment(c.data.client_secret);b.error?d(b.error.message):(C("Subscription updated successfully!"),f())}else C(`✅ Demo subscription to ${x.name} tier activated! (No payment required in test mode)`),f(),setTimeout(()=>{_()},1e3)}catch(o){console.error("Subscription error:",o);const c=o.response?.data?.detail||o.message||"Failed to update subscription";d(c)}finally{g(!1)}},q=async()=>{if(window.confirm("Are you sure you want to cancel your subscription?")){g(!0);try{const s=localStorage.getItem("access_token");await y.delete(N("/api/billing/subscription"),{headers:{Authorization:`Bearer ${s}`}}),C("Subscription will be canceled at the end of the billing period"),f()}catch{d("Failed to cancel subscription")}finally{g(!1)}}},G=s=>s===0?"Free":`$${s}/month`,W=s=>({free:["1,000 API calls/month","3 projects","1 team member","Basic discovery & testing","Community support"],starter:["10,000 API calls/month","10 projects","3 team members","AI-powered analysis","Mock servers","Export/Import","Email support"],professional:["100,000 API calls/month","50 projects","10 team members","Advanced AI insights","Custom integrations","Priority support","API analytics dashboard"],enterprise:["Unlimited API calls","Unlimited projects","Unlimited team members","SSO/SAML authentication","SLA guarantees","Dedicated support","Custom deployment","Audit logs","Custom AI models"]})[s]||[];return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800/50 backdrop-blur-lg border-b border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs(p,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-8 h-8 text-purple-500"}),e.jsx("span",{className:"text-xl font-bold text-white",children:"API Orchestrator"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(p,{to:"/",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Home"})]}),e.jsxs(p,{to:"/dashboard",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(p,{to:"/billing",className:"flex items-center space-x-2 px-4 py-2 text-purple-400 transition",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"Billing"})]}),e.jsxs(p,{to:"/profile",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{onClick:()=>{a(),i("/")},className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"Logout"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 mb-4",children:"Manage Your Subscription"}),e.jsx("p",{className:"text-xl text-gray-400",children:"Scale your API operations with flexible pricing"}),R.startsWith("pk_test_")&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Test Mode Active"}),e.jsx("span",{className:"text-sm",children:"- Using Stripe test environment"})]})]}),I&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/50 rounded-lg flex items-center",children:[e.jsx(L,{className:"w-5 h-5 text-red-400 mr-2"}),e.jsx("span",{className:"text-red-400",children:I})]}),E&&e.jsxs("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/50 rounded-lg flex items-center",children:[e.jsx($,{className:"w-5 h-5 text-green-400 mr-2"}),e.jsx("span",{className:"text-green-400",children:E})]}),t&&e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-lg border border-gray-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Current Usage"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Current Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white capitalize",children:t.subscription.tier})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"API Calls This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[t.usage.api_calls.toLocaleString(),t.limits.api_calls!==-1&&e.jsxs("span",{className:"text-sm text-gray-500",children:["/",t.limits.api_calls.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"AI Analyses"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.usage.ai_analyses})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",t.usage.total_cost.toFixed(2)]})]})]}),t.limits.api_calls!==-1&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-1",children:[e.jsx("span",{children:"API Usage"}),e.jsxs("span",{children:[Math.round(t.usage.api_calls/t.limits.api_calls*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,t.usage.api_calls/t.limits.api_calls*100)}%`}})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:P&&Object.entries(P).map(([s,x])=>{const o=t?.subscription.tier===s,c=["free","starter","professional","enterprise"].indexOf(t?.subscription.tier||"free"),b=["free","starter","professional","enterprise"].indexOf(s)<c,X=W(s);return e.jsxs("div",{className:`bg-gray-800/50 backdrop-blur-lg rounded-2xl border ${o?"border-purple-500 shadow-2xl shadow-purple-500/20":"border-gray-700"} ${s==="professional"?"transform scale-105 border-purple-500":""} p-6 transition-all hover:border-gray-600`,children:[s==="professional"&&e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white text-center py-1 px-3 rounded-full text-sm font-semibold mb-4",children:"MOST POPULAR"}),e.jsx("h3",{className:"text-2xl font-bold text-white capitalize mb-2",children:x.name}),e.jsx("div",{className:"text-3xl font-bold text-white mb-4",children:G(x.price)}),e.jsx("ul",{className:"space-y-3 mb-6",children:X.map((j,K)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx($,{className:"w-3 h-3 text-green-400"})}),e.jsx("span",{className:"text-gray-300 ml-2",children:j})]},K))}),o?e.jsx("button",{className:"w-full py-2 px-4 bg-purple-600/20 text-purple-400 border border-purple-500/30 rounded-lg font-semibold",disabled:!0,children:"Current Plan"}):e.jsx("button",{type:"button",onClick:j=>{j.preventDefault(),j.stopPropagation(),F(s)},disabled:A,className:`w-full py-2 px-4 rounded-lg font-semibold transition-all ${s==="enterprise"?"bg-gray-700/50 text-purple-400 border border-purple-500/30 hover:bg-purple-600/20":s==="professional"?"bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:opacity-90":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"} disabled:opacity-50`,children:A?e.jsx(k,{className:"w-5 h-5 animate-spin mx-auto"}):s==="enterprise"?"Contact Sales":b?"Downgrade":"Upgrade"})]},s)})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Usage-Based Pricing"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Pay only for what you use beyond your plan limits"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Extra API Calls"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.001"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per call"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"AI Analysis"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.10"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per analysis"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Mock Server"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.05"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per hour"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Export Operation"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.01"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per export"})]})]})]}),t?.payment_methods.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Payment Methods"}),e.jsx("div",{className:"space-y-3",children:t.payment_methods.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsxs("span",{className:"font-medium",children:[s.brand," •••• ",s.last4]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-3",children:["Expires ",s.exp_month,"/",s.exp_year]})]})},s.id))})]}),t?.invoices.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Recent Invoices"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"Date"}),e.jsx("th",{className:"text-left py-2",children:"Invoice"}),e.jsx("th",{className:"text-left py-2",children:"Amount"}),e.jsx("th",{className:"text-left py-2",children:"Status"}),e.jsx("th",{className:"text-left py-2",children:"Action"})]})}),e.jsx("tbody",{children:t.invoices.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:s.number||s.id.slice(-8)}),e.jsxs("td",{className:"py-2",children:["$",s.amount.toFixed(2)]}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:s.status})}),e.jsx("td",{className:"py-2",children:s.pdf_url&&e.jsxs("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Download"]})})]},s.id))})]})})]}),t?.subscription.tier!=="free"&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("button",{onClick:q,disabled:A,className:"text-red-600 hover:text-red-700 font-medium",children:"Cancel Subscription"})})]})]})};export{ye as default};
//# sourceMappingURL=Billing-CEeGa6L-.js.map
