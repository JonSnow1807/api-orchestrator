import{u as G,a as V,r as m,f as y,j as e,L as p,H as Y,C as K}from"./index-BTLEtJ-d.js";import{g as N}from"./config-BuUSr6Gn.js";import{L,D as X}from"./loader-circle-BqiqjjVg.js";import{Z}from"./zap-DnJaUqTb.js";import{L as J,a as Q}from"./log-out-CG0aXY_U.js";import{C as k}from"./credit-card-BYB842SD.js";import{U as W}from"./user-Dl6ZWlBc.js";import{C as T}from"./check-Dq30_KRz.js";var D="https://js.stripe.com/v3",ee=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var se=function(){for(var l=document.querySelectorAll('script[src^="'.concat(D,'"]')),a=0;a<l.length;a++){var n=l[a];if(ee.test(n.src))return n}return null},$=function(l){var a="",n=document.createElement("script");n.src="".concat(D).concat(a);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},u=null,v=null,w=null,te=function(l){return function(){l(new Error("Failed to load Stripe.js"))}},re=function(l,a){return function(){window.Stripe?l(window.Stripe):a(new Error("Stripe.js not available"))}},ae=function(l){return u!==null?u:(u=new Promise(function(a,n){if(typeof window>"u"||typeof document>"u"){a(null);return}if(window.Stripe){a(window.Stripe);return}try{var r=se();if(!(r&&l)){if(!r)r=$(l);else if(r&&w!==null&&v!==null){var t;r.removeEventListener("load",w),r.removeEventListener("error",v),(t=r.parentNode)===null||t===void 0||t.removeChild(r),r=$(l)}}w=re(a,n),v=te(n),r.addEventListener("load",w),r.addEventListener("error",v)}catch(S){n(S);return}}),u.catch(function(a){return u=null,Promise.reject(a)}))},h,le=function(){return h||(h=ae(null).catch(function(l){return h=null,Promise.reject(l)}),h)};Promise.resolve().then(function(){return le()}).catch(function(i){console.warn(i)});const ne=void 0;console.error("Stripe publishable key is missing. Please set VITE_STRIPE_PUBLISHABLE_KEY in .env");const U=null,be=()=>{const i=G(),{user:l,logout:a}=V(),[n,r]=m.useState(!0),[t,S]=m.useState(null),[P,B]=m.useState(null),[ie,oe]=m.useState(null),[I,g]=m.useState(!1),[E,d]=m.useState(""),[C,A]=m.useState("");m.useEffect(()=>{b(),_()},[]);const b=async()=>{try{const s=localStorage.getItem("access_token"),x=await y.get(N("/api/billing/info"),{headers:{Authorization:`Bearer ${s}`}});S(x.data)}catch(s){console.error("Error fetching billing info:",s),d("Failed to load billing information")}},_=async()=>{try{const s=await y.get(N("/api/billing/pricing"));B(s.data.tiers),r(!1)}catch(s){console.error("Error fetching pricing:",s),r(!1)}},M=async s=>{console.log("Subscribing to tier:",s);const x=P?.[s];if(!x){d("Invalid subscription tier");return}g(!0),d("");try{const o=localStorage.getItem("access_token");if(!o){d("Please login to subscribe"),i("/login");return}console.log("Calling subscription API...");const c=await y.post(N("/api/billing/subscription"),{tier:s},{headers:{Authorization:`Bearer ${o}`}});if(console.log("Subscription response:",c.data),c.data.checkout_url)console.log("Redirecting to Stripe Checkout..."),window.location.href=c.data.checkout_url;else if(c.data.client_secret){if(!U){d("Payment system is not configured.");return}const f=await(await U).confirmCardPayment(c.data.client_secret);f.error?d(f.error.message):(A("Subscription updated successfully!"),b())}else A(`✅ Demo subscription to ${x.name} tier activated! (No payment required in test mode)`),b(),setTimeout(()=>{_()},1e3)}catch(o){console.error("Subscription error:",o);const c=o.response?.data?.detail||o.message||"Failed to update subscription";d(c)}finally{g(!1)}},O=async()=>{if(window.confirm("Are you sure you want to cancel your subscription?")){g(!0);try{const s=localStorage.getItem("access_token");await y.delete(N("/api/billing/subscription"),{headers:{Authorization:`Bearer ${s}`}}),A("Subscription will be canceled at the end of the billing period"),b()}catch{d("Failed to cancel subscription")}finally{g(!1)}}},R=s=>s===0?"Free":`$${s}/month`,F=s=>({free:["1,000 API calls/month","3 projects","1 team member","Basic discovery & testing","Community support"],starter:["10,000 API calls/month","10 projects","3 team members","AI-powered analysis","Mock servers","Export/Import","Email support"],professional:["100,000 API calls/month","50 projects","10 team members","Advanced AI insights","Custom integrations","Priority support","API analytics dashboard"],enterprise:["Unlimited API calls","Unlimited projects","Unlimited team members","SSO/SAML authentication","SLA guarantees","Dedicated support","Custom deployment","Audit logs","Custom AI models"]})[s]||[];return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800/50 backdrop-blur-lg border-b border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs(p,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-8 h-8 text-purple-500"}),e.jsx("span",{className:"text-xl font-bold text-white",children:"API Orchestrator"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(p,{to:"/",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:"Home"})]}),e.jsxs(p,{to:"/dashboard",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(p,{to:"/billing",className:"flex items-center space-x-2 px-4 py-2 text-purple-400 transition",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"Billing"})]}),e.jsxs(p,{to:"/profile",className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(W,{className:"w-5 h-5"}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{onClick:()=>{a(),i("/")},className:"flex items-center space-x-2 px-4 py-2 text-gray-300 hover:text-white transition",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{children:"Logout"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 mb-4",children:"Manage Your Subscription"}),e.jsx("p",{className:"text-xl text-gray-400",children:"Scale your API operations with flexible pricing"}),ne]}),E&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/50 rounded-lg flex items-center",children:[e.jsx(K,{className:"w-5 h-5 text-red-400 mr-2"}),e.jsx("span",{className:"text-red-400",children:E})]}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/50 rounded-lg flex items-center",children:[e.jsx(T,{className:"w-5 h-5 text-green-400 mr-2"}),e.jsx("span",{className:"text-green-400",children:C})]}),t&&e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-lg border border-gray-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Current Usage"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Current Plan"}),e.jsx("p",{className:"text-2xl font-bold text-white capitalize",children:t.subscription.tier})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"API Calls This Month"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[t.usage.api_calls.toLocaleString(),t.limits.api_calls!==-1&&e.jsxs("span",{className:"text-sm text-gray-500",children:["/",t.limits.api_calls.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"AI Analyses"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.usage.ai_analyses})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",t.usage.total_cost.toFixed(2)]})]})]}),t.limits.api_calls!==-1&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-1",children:[e.jsx("span",{children:"API Usage"}),e.jsxs("span",{children:[Math.round(t.usage.api_calls/t.limits.api_calls*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 h-2 rounded-full",style:{width:`${Math.min(100,t.usage.api_calls/t.limits.api_calls*100)}%`}})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:P&&Object.entries(P).map(([s,x])=>{const o=t?.subscription.tier===s,c=["free","starter","professional","enterprise"].indexOf(t?.subscription.tier||"free"),f=["free","starter","professional","enterprise"].indexOf(s)<c,q=F(s);return e.jsxs("div",{className:`bg-gray-800/50 backdrop-blur-lg rounded-2xl border ${o?"border-purple-500 shadow-2xl shadow-purple-500/20":"border-gray-700"} ${s==="professional"?"transform scale-105 border-purple-500":""} p-6 transition-all hover:border-gray-600`,children:[s==="professional"&&e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white text-center py-1 px-3 rounded-full text-sm font-semibold mb-4",children:"MOST POPULAR"}),e.jsx("h3",{className:"text-2xl font-bold text-white capitalize mb-2",children:x.name}),e.jsx("div",{className:"text-3xl font-bold text-white mb-4",children:R(x.price)}),e.jsx("ul",{className:"space-y-3 mb-6",children:q.map((j,H)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(T,{className:"w-3 h-3 text-green-400"})}),e.jsx("span",{className:"text-gray-300 ml-2",children:j})]},H))}),o?e.jsx("button",{className:"w-full py-2 px-4 bg-purple-600/20 text-purple-400 border border-purple-500/30 rounded-lg font-semibold",disabled:!0,children:"Current Plan"}):e.jsx("button",{type:"button",onClick:j=>{j.preventDefault(),j.stopPropagation(),M(s)},disabled:I,className:`w-full py-2 px-4 rounded-lg font-semibold transition-all ${s==="enterprise"?"bg-gray-700/50 text-purple-400 border border-purple-500/30 hover:bg-purple-600/20":s==="professional"?"bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:opacity-90":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 hover:text-white"} disabled:opacity-50`,children:I?e.jsx(L,{className:"w-5 h-5 animate-spin mx-auto"}):s==="enterprise"?"Contact Sales":f?"Downgrade":"Upgrade"})]},s)})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Usage-Based Pricing"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Pay only for what you use beyond your plan limits"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Extra API Calls"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.001"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per call"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"AI Analysis"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.10"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per analysis"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Mock Server"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.05"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per hour"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Export Operation"}),e.jsx("p",{className:"text-xl font-bold",children:"$0.01"}),e.jsx("p",{className:"text-xs text-gray-500",children:"per export"})]})]})]}),t?.payment_methods.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Payment Methods"}),e.jsx("div",{className:"space-y-3",children:t.payment_methods.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsxs("span",{className:"font-medium",children:[s.brand," •••• ",s.last4]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-3",children:["Expires ",s.exp_month,"/",s.exp_year]})]})},s.id))})]}),t?.invoices.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Recent Invoices"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"Date"}),e.jsx("th",{className:"text-left py-2",children:"Invoice"}),e.jsx("th",{className:"text-left py-2",children:"Amount"}),e.jsx("th",{className:"text-left py-2",children:"Status"}),e.jsx("th",{className:"text-left py-2",children:"Action"})]})}),e.jsx("tbody",{children:t.invoices.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"py-2",children:s.number||s.id.slice(-8)}),e.jsxs("td",{className:"py-2",children:["$",s.amount.toFixed(2)]}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.status==="paid"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:s.status})}),e.jsx("td",{className:"py-2",children:s.pdf_url&&e.jsxs("a",{href:s.pdf_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Download"]})})]},s.id))})]})})]}),t?.subscription.tier!=="free"&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("button",{onClick:O,disabled:I,className:"text-red-600 hover:text-red-700 font-medium",children:"Cancel Subscription"})})]})]})};export{be as default};
//# sourceMappingURL=Billing-CBFy2DC6.js.map
