import{o as U,u as G,a as J,r as o,f as v,j as e,d as V}from"./index-Basy_IE4.js";import{g as w,a as X}from"./config-BuUSr6Gn.js";import{c as q,f as H,e as K,T as Q,A as Y,M as Z}from"./MockServerManager-CBnWNsuj.js";import{L as k,C as ee}from"./trending-up-FYVwk6vX.js";import{F as h,B as P,A as se}from"./file-code-Dl3hztRH.js";import{T as O,S}from"./test-tube-BfybF4AJ.js";import{A as te}from"./arrow-left-CVUFah1_.js";import{D as A}from"./loader-circle-BNZ6yrVC.js";import"./shield-DPwD5MOV.js";import"./zap-CKHNE7YT.js";const ue=()=>{const{id:m}=U(),C=G(),{user:re}=J(),p=o.useRef(null),_=o.useRef(null),[a,M]=o.useState(null),[R,F]=o.useState(!0),[T,u]=o.useState(!1),[g,b]=o.useState(null),[j,y]=o.useState([]),[l,L]=o.useState("overview"),[$,N]=o.useState(!1),[i,d]=o.useState({discovery:{status:"pending",count:0},spec:{status:"pending",count:0},test:{status:"pending",count:0},ai:{status:"pending",count:0},mock:{status:"pending",count:0}});o.useEffect(()=>(I(),D(),()=>{p.current&&p.current.close()}),[m]),o.useEffect(()=>{_.current?.scrollIntoView({behavior:"smooth"})},[j]);const I=async()=>{try{const s=await v.get(w(`/api/projects/${m}`));if(M(s.data),s.data.tasks&&s.data.tasks.length>0){const t=s.data.tasks[s.data.tasks.length-1];t.status==="running"&&(u(!0),b(t))}}catch(s){console.error("Failed to fetch project:",s)}finally{F(!1)}},D=()=>{try{const s=new WebSocket(X());s.onopen=()=>{N(!0),n("Connected to orchestration server","success")},s.onmessage=t=>{try{const c=JSON.parse(t.data);E(c)}catch(c){console.error("Failed to parse WebSocket message:",c)}},s.onclose=()=>{N(!1),n("Disconnected from server","error"),setTimeout(()=>{(!p.current||p.current.readyState===WebSocket.CLOSED)&&D()},3e3)},s.onerror=t=>{console.error("WebSocket error:",t),n("Connection error","error")},p.current=s}catch(s){console.error("Failed to connect WebSocket:",s),N(!1)}},E=s=>{if(!(s.project_id&&s.project_id!==parseInt(m)))switch(s.type){case"progress":n(s.message,"info"),W(s.stage);break;case"discovery_complete":d(t=>({...t,discovery:{status:"completed",count:s.apis_found}})),n(`Discovery complete: ${s.apis_found} APIs found`,"discovery");break;case"spec_complete":d(t=>({...t,spec:{status:"completed",count:s.paths}})),n(`Spec generation complete: ${s.paths} paths`,"spec");break;case"tests_complete":d(t=>({...t,test:{status:"completed",count:s.tests_generated}})),n(`Test generation complete: ${s.tests_generated} tests`,"test");break;case"ai_complete":d(t=>({...t,ai:{status:"completed",count:1}})),n("AI analysis complete","ai");break;case"mock_complete":d(t=>({...t,mock:{status:"completed",count:1}})),n("Mock server ready","mock");break;case"orchestration_complete":u(!1),b(null),n("âœ¨ Orchestration complete!","success"),I();break;case"error":n(`Error: ${s.error}`,"error");break}},W=(s,t)=>{const r={discovery:"discovery",spec_generation:"spec",test_generation:"test",ai_analysis:"ai",mock_server:"mock"}[s];r&&d(x=>({...x,[r]:{...x[r],status:"active"}}))},n=(s,t="info")=>{const c=new Date().toLocaleTimeString();y(r=>[...r,{text:s,type:t,timestamp:c}])},z=async()=>{try{u(!0),y([]),d({discovery:{status:"pending",count:0},spec:{status:"pending",count:0},test:{status:"pending",count:0},ai:{status:"pending",count:0},mock:{status:"pending",count:0}});const s=await v.post(w(`/api/projects/${m}/orchestrate`));b(s.data),n(`Orchestration started: Task ${s.data.task_id}`,"info")}catch(s){n(`Failed to start orchestration: ${s.message}`,"error"),u(!1)}},f=async s=>{try{const t=await v.get(w(`/api/export/${g?.task_id||a.tasks[0]?.task_id}?format=${s}`),{responseType:s==="zip"?"blob":"json"});if(s==="zip"){const c=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=c,r.setAttribute("download",`${a.name}-artifacts.zip`),document.body.appendChild(r),r.click()}else{const c=JSON.stringify(t.data,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(c),x=document.createElement("a");x.setAttribute("href",r),x.setAttribute("download",`${a.name}-${s}.json`),x.click()}}catch(t){n(`Download failed: ${t.message}`,"error")}};if(R)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:e.jsx(k,{className:"w-8 h-8 text-purple-600 animate-spin"})});if(!a)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Project Not Found"}),e.jsx("button",{onClick:()=>C("/dashboard"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Back to Dashboard"})]})});const B=[{id:"discovery",name:"Discovery Agent",icon:h,description:"Scanning for API endpoints",status:i.discovery.status,count:i.discovery.count},{id:"spec",name:"Spec Generator",icon:h,description:"Creating OpenAPI specs",status:i.spec.status,count:i.spec.count},{id:"test",name:"Test Generator",icon:O,description:"Generating test suites",status:i.test.status,count:i.test.count},{id:"ai",name:"AI Analyzer",icon:P,description:"AI-powered insights",status:i.ai.status,count:i.ai.count},{id:"mock",name:"Mock Server",icon:S,description:"Creating mock server",status:i.mock.status,count:i.mock.count}];return e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800/50 backdrop-blur-lg border-b border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>C("/dashboard"),className:"flex items-center space-x-2 text-gray-400 hover:text-white transition",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Dashboard"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-6 h-6 text-purple-500"}),e.jsx("h1",{className:"text-xl font-semibold text-white",children:a.name})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-full ${$?"bg-green-500/20 text-green-400 border border-green-500/50":"bg-red-500/20 text-red-400 border border-red-500/50"}`,children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:$?"Connected":"Disconnected"})]}),e.jsx("button",{onClick:z,disabled:T,className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:T?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Orchestrating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Start Orchestration"})]})}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-white",children:e.jsx(K,{className:"w-5 h-5"})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"border-b border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:["overview","agents","ai-analysis","mock-server","console","artifacts"].map(s=>e.jsx("button",{onClick:()=>L(s),className:`py-2 px-1 border-b-2 font-medium text-sm capitalize transition ${l===s?"border-purple-500 text-purple-400":"border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-300"}`,children:s},s))})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8",children:[l==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Project Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Description"}),e.jsx("p",{className:"text-white",children:a.description||"No description provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Source Type"}),e.jsx("p",{className:"text-white capitalize",children:a.source_type||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Created"}),e.jsx("p",{className:"text-white",children:new Date(a.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Source Path"}),e.jsx("p",{className:"text-white font-mono text-sm bg-gray-900 p-2 rounded",children:a.source_path||"Not configured"})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Statistics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"APIs Found"}),e.jsx("span",{className:"text-2xl font-bold text-purple-400",children:a.api_count||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Tests Generated"}),e.jsx("span",{className:"text-2xl font-bold text-blue-400",children:a.test_count||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Security Score"}),e.jsxs("span",{className:"text-2xl font-bold text-green-400",children:[a.security_score||"N/A","%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Tasks Run"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-400",children:a.task_count||0})]})]})]})]}),l==="agents"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(s=>{const t=s.icon,c=s.status==="active",r=s.status==="completed";return e.jsxs("div",{className:`bg-gray-800/50 backdrop-blur rounded-xl border p-6 transition ${c?"border-purple-500 shadow-lg shadow-purple-500/20":r?"border-green-500/50":"border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${c?"bg-purple-600/20":r?"bg-green-600/20":"bg-gray-700"}`,children:e.jsx(t,{className:`w-6 h-6 ${c?"text-purple-400":r?"text-green-400":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-gray-400",children:s.description})]})]}),c&&e.jsx(k,{className:"w-5 h-5 text-purple-400 animate-spin"}),r&&e.jsx(V,{className:"w-5 h-5 text-green-400"})]}),s.count>0&&e.jsxs("div",{className:"text-center py-2 px-3 bg-gray-900 rounded-lg",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:s.count}),e.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:[s.id==="discovery"&&"endpoints",s.id==="spec"&&"paths",s.id==="test"&&"tests",s.id==="ai"&&"insights",s.id==="mock"&&"server"]})]})]},s.id)})}),l==="console"&&e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Live Console"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-gray-400 hover:text-white transition",children:"Clear"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg h-96 overflow-y-auto p-4 font-mono text-sm",children:[j.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8",children:"No messages yet. Start orchestration to see live updates."}):j.map((s,t)=>e.jsxs("div",{className:`mb-2 ${s.type==="error"?"text-red-400":s.type==="success"?"text-green-400":s.type==="discovery"?"text-purple-400":s.type==="spec"?"text-blue-400":s.type==="test"?"text-yellow-400":s.type==="ai"?"text-cyan-400":s.type==="mock"?"text-orange-400":"text-gray-300"}`,children:[e.jsxs("span",{className:"text-gray-500",children:["[",s.timestamp,"]"]})," ",s.text]},t)),e.jsx("div",{ref:_})]})]}),l==="ai-analysis"&&e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-6 flex items-center",children:[e.jsx(P,{className:"w-6 h-6 mr-2 text-purple-400"}),"AI Analysis Results"]}),e.jsx(Y,{projectId:m})]}),l==="mock-server"&&e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-6 flex items-center",children:[e.jsx(S,{className:"w-6 h-6 mr-2 text-purple-400"}),"Mock Server Management"]}),e.jsx(Z,{taskId:g})]}),l==="artifacts"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g||a.tasks&&a.tasks.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsx(h,{className:"w-8 h-8 text-blue-500 mb-4"}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"OpenAPI Specification"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Complete API documentation in OpenAPI 3.0 format"}),e.jsxs("button",{onClick:()=>f("json"),className:"w-full px-4 py-2 bg-blue-600/20 text-blue-400 border border-blue-500/50 rounded-lg hover:bg-blue-600/30 transition",children:[e.jsx(A,{className:"w-4 h-4 inline mr-2"}),"Download JSON"]})]}),e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsx(O,{className:"w-8 h-8 text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Test Suites"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Comprehensive tests for all endpoints"}),e.jsxs("button",{onClick:()=>f("postman"),className:"w-full px-4 py-2 bg-yellow-600/20 text-yellow-400 border border-yellow-500/50 rounded-lg hover:bg-yellow-600/30 transition",children:[e.jsx(A,{className:"w-4 h-4 inline mr-2"}),"Postman Collection"]})]}),e.jsxs("div",{className:"bg-gray-800/50 backdrop-blur rounded-xl border border-gray-700 p-6",children:[e.jsx(S,{className:"w-8 h-8 text-orange-500 mb-4"}),e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Mock Server"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Ready-to-run mock server with Docker"}),e.jsxs("button",{onClick:()=>f("zip"),className:"w-full px-4 py-2 bg-orange-600/20 text-orange-400 border border-orange-500/50 rounded-lg hover:bg-orange-600/30 transition",children:[e.jsx(A,{className:"w-4 h-4 inline mr-2"}),"Download All"]})]})]}):e.jsxs("div",{className:"col-span-3 text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No artifacts yet"}),e.jsx("p",{className:"text-gray-500",children:"Run orchestration to generate artifacts"})]})})]})]})};export{ue as default};
//# sourceMappingURL=ProjectDetails-Bf_LCbRa.js.map
